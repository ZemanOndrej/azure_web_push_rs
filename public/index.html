<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>test</title>
</head>

<body>
	<script defer>
		const publicVapidKey = 'BG8BNxzutVBk_n8yFG6S1U73F5qUpJZVk5d_AP4IvVi4OV2LL4q7sBJ_aey7Tn2_vSznq_3I2ewGdhOsrU_wTdk='; // Replace with your VAPID public key

		if ('serviceWorker' in navigator) {
			navigator.serviceWorker.register('/service-worker.js')
				.then(function (registration) {
					console.log('Service Worker registered with scope:', registration);
					return registration.pushManager.getSubscription()
						.then(function (subscription) {
							console.log('subscription', subscription);
							if (subscription === null) {
								// Subscribe the user
								return registration.pushManager.subscribe({
									userVisibleOnly: true,
									applicationServerKey: urlBase64ToUint8Array(publicVapidKey)
								});
							} else {
								return subscription;
							}
						});
				})
				.then(function (subscription) {
					console.log('User is subscribed:', subscription);
					// Send subscription to your server
					return fetch('http://localhost:3000/registration', {
						method: 'POST',
						body: JSON.stringify(subscription),
						headers: {
							'Content-Type': 'application/json'
						}
					});
				})
				.catch(function (error) {
					console.error('Service Worker Error', error);
				});
		}


		function urlBase64ToUint8Array(base64String) {
			const padding = '='.repeat((4 - base64String.length % 4) % 4);
			const base64 = (base64String + padding)
				.replace(/\-/g, '+')
				.replace(/_/g, '/');

			const rawData = window.atob(base64);
			const outputArray = new Uint8Array(rawData.length);

			for (let i = 0; i < rawData.length; ++i) {
				outputArray[i] = rawData.charCodeAt(i);
			}
			return outputArray;
		}
	</script>


	<button id="send_notification">send notification</button>
	<button id="btn_get_registrations">get registrations</button>
	<div style="height: 500px; background-color: azure;" id="text_response_field"></div>
	<script src="index.js" defer></script>
</body>

</html>